# Шпаргалка по использованию Docker и флагам

## docker build

- `docker build [опции] PATH | URL | -`
  - `-t`, `--tag name[:tag]` - задать имя и тег образа
  - `-f`, `--file FILE` - указать путь к Dockerfile (по умолчанию ./Dockerfile)
  - `--no-cache` - не использовать кеш при сборке, собрать всё заново
  - `--pull` - при сборке проверить наличие новой версии базового образа (FROM ...) и скачать, если есть
  - `--build-arg NAME=VALUE` - передать аргумент сборки (переменные ARG в Dockerfile)
  - `--target NAME` - собрать только до указанного stage в многоэтапной сборке
  - `--progress plain` - показать сборку в виде обычного текста, без анимации
  - `--platform linux/amd64` - задать архитектуру образа
  - `--rm` - удалить временные контейнеры после сборки (по умолчанию включено)

Примечание: *Базовый образ* - это тот, который указан в первой строке Dockerfile (`FROM python:3.12` и т.п.), с которого начинается сборка вашего образа

## docker run

- `docker run [опции] IMAGE [команда] [аргументы]`
  - `--name NAME` - задать имя контейнера
  - `-d`, `--detach` - запустить контейнер в фоне
  - `-i`, `--interactive` - держать stdin открытым (для интерактивных команд)
  - `-t`, `--tty` - создать псевдотерминал (для bash и т.п.)
  - `--rm` - удалить контейнер после завершения
  - `-p`, `--publish HOST:CONTAINER` - проброс порта (хост:контейнер)
  - `-P`, `--publish-all` - пробросить все опубликованные в Dockerfile порты
  - `-v`, `--volume SRC:DEST[:MODE]` - смонтировать директорию или том
    - `ro` - только чтение
    - `rw` - чтение и запись (по умолчанию)
  - `--mount type=bind,source=$(pwd),target=/app` - альтернатива -v (новый формат)
  - `-e`, `--env KEY=VALUE` - задать переменную окружения
  - `--env-file FILE` - загрузить переменные окружения из файла
  - `--network NAME` - подключить контейнер к сети
  - `--link NAME:ALIAS` - связать с другим контейнером (устарело, но работает)
  - `--restart POLICY` - задать автоперезапуск (`no`, `always`, `on-failure`, `unless-stopped`)
  - `--entrypoint CMD` - переопределить ENTRYPOINT из Dockerfile
  - `-u`, `--user UID[:GID]` - запустить от указанного пользователя
  - `-w`, `--workdir PATH` - задать рабочую директорию внутри контейнера
  - `--cpu-shares N` - приоритет использования CPU (большее число = выше приоритет)
  - `--memory 512m` - ограничить использование памяти
  - `--cpus 1.5` - ограничить число доступных ядер
  - `-h`, `--hostname NAME` - задать имя хоста внутри контейнера
  - `--device /dev/ttyUSB0` - пробросить устройство внутрь контейнера

## docker ps

- `docker ps [опции]`
  - `-a`, `--all` - показать все контейнеры, включая остановленные
  - `-q`, `--quiet` - вывести только ID контейнеров
  - `--filter "key=value"` - фильтровать список (по статусу, имени и т.д.)
  - `--format "{{.Names}}: {{.Status}}"` - задать шаблон вывода
  - `--no-trunc` - не обрезать длинные строки

## docker exec

- `docker exec [опции] CONTAINER COMMAND`
  - `-i`, `--interactive` - держать stdin открытым
  - `-t`, `--tty` - выделить терминал
  - `-d`, `--detach` - выполнить команду в фоне
  - `-u`, `--user USER` - выполнить от имени пользователя
  - `-w`, `--workdir DIR` - задать рабочую директорию
  - `-e`, `--env KEY=VALUE` - задать переменные окружения для команды

## docker logs

- `docker logs [опции] CONTAINER`
  - `-f`, `--follow` - следить за логами в реальном времени
  - `--tail N` - показать последние N строк
  - `--since TIME` - показать логи начиная с определённого времени
  - `--until TIME` - до определённого времени
  - `-t`, `--timestamps` - показывать время каждой записи

## docker rm

- `docker rm [опции] CONTAINER`
  - `-f`, `--force` - удалить даже запущенный контейнер (принудительно)
  - `-v`, `--volumes` - удалить связанные тома

## docker rmi

- `docker rmi [опции] IMAGE`
  - `-f`, `--force` - удалить даже если образ используется
  - `--no-prune` - не удалять промежуточные образы

## docker images

- `docker images [опции]`
  - `-a`, `--all` - показать все, включая промежуточные
  - `-q`, `--quiet` - только ID
  - `--filter "dangling=true"` - только образы без тега
  - `--format "{{.Repository}}:{{.Tag}} ({{.Size}})"` - вывод по шаблону

## docker volume

- `docker volume [команда]`
  - `create NAME` - создать том
  - `inspect NAME` - информация о томе
  - `ls` - список
  - `rm NAME` - удалить
  - `prune` - удалить неиспользуемые
  - флаги:
    - `-f`, `--force` - пропустить подтверждение

## docker network

- `docker network [команда]`
  - `create NAME` - создать сеть
    - `--driver bridge|host|none` - тип сети
    - `--subnet 172.20.0.0/16` - задать подсеть
    - `--gateway 172.20.0.1` - задать шлюз
  - `connect NET CONTAINER` - подключить контейнер
  - `disconnect NET CONTAINER` - отключить контейнер
  - `inspect NAME` - информация о сети
  - `ls` - список
  - `rm NAME` - удалить сеть

## docker compose

- `docker compose [команда]`
  - `up -d` - запустить все сервисы в фоне
    - `--build` - пересобрать перед запуском
    - `--force-recreate` - пересоздать даже без изменений
  - `down` - остановить и удалить всё
    - `-v`, `--volumes` - удалить тома
    - `--rmi all` - удалить образы
  - `build` - собрать образы
    - `--no-cache` - без кеша
  - `logs -f` - логи всех сервисов
  - `exec SERVICE bash` - войти в контейнер сервиса
  - `ps` - список сервисов
  - `restart SERVICE` - перезапустить сервис

## docker system

- `docker system df` - показать использование диска
- `docker system prune -a`
  - `-a`, `--all` - удалить всё неиспользуемое (включая образы без контейнеров)
  - `-f`, `--force` - без подтверждения
  - `--volumes` - удалить неиспользуемые тома

## docker inspect / stats / cp / commit

- `docker inspect NAME` - подробная информация об объекте
  - `--format "{{.NetworkSettings.IPAddress}}"` - вывести конкретное поле
- `docker stats` - статистика по использованию CPU и памяти
  - `--no-stream` - показать один раз и выйти
- `docker cp SRC DEST` - копировать файлы между хостом и контейнером
- `docker commit CONTAINER IMAGE[:TAG]` - сохранить контейнер как образ
  - `-a`, `--author "Имя"` - указать автора
  - `-m`, `--message "Описание"` - добавить комментарий

![docker.png](General/Docker/docker.png)
