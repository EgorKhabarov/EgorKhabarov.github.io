<h1>itertools</h1>
<h2>Infinite iterators</h2>
<p>Потенциально бесконечные итераторы
Всегда требуют явного ограничения</p>
<h3>count</h3>
<p>Возвращает итератор, который генерирует последовательность чисел,
начиная с <code>start</code> (по умолчанию 0) с шагом <code>step</code> (по умолчанию 1)</p>
<div class="code_element"><div class="lang_line"><text>python</text><button class="copy_code_button" onclick="CopyCode(this)"><svg width="1.2em" height="1.2em" viewBox="0 0 24 24"><use href="#icon_code_copy"/></svg><text class="unselectable">Copy code</text></button></div><div class="code language-python"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">count</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">count</span><span class="p">(</span><span class="mi">10</span><span class="k">,</span> <span class="mi">2</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">10</span>
<span class="sd">12</span>
<span class="sd">14</span>
<span class="sd">16</span>
<span class="sd">18</span>
<span class="sd">20</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div></div></div>

<h3>cycle</h3>
<p>Бесконечно повторяет элементы переданного итератора</p>
<div class="code_element"><div class="lang_line"><text>python</text><button class="copy_code_button" onclick="CopyCode(this)"><svg width="1.2em" height="1.2em" viewBox="0 0 24 24"><use href="#icon_code_copy"/></svg><text class="unselectable">Copy code</text></button></div><div class="code language-python"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">cycle</span>

<span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">cycle</span><span class="p">(</span><span class="s2">&quot;AB&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A</span>
<span class="sd">B</span>
<span class="sd">A</span>
<span class="sd">B</span>
<span class="sd">A</span>
<span class="sd">B</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div></div></div>

<h3>repeat</h3>
<p>Повторяет переданный элемент <code>object</code> бесконечно или заданное количество раз <code>times</code></p>
<div class="code_element"><div class="lang_line"><text>python</text><button class="copy_code_button" onclick="CopyCode(this)"><svg width="1.2em" height="1.2em" viewBox="0 0 24 24"><use href="#icon_code_copy"/></svg><text class="unselectable">Copy code</text></button></div><div class="code language-python"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">repeat</span>

<span class="nb">list</span><span class="p">(</span><span class="n">repeat</span><span class="p">(</span><span class="mi">10</span><span class="k">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="c1"># [10, 10, 10]</span>
</pre></div></div></div>

<h2>Iterators terminating on the shortest input sequence</h2>
<p>Итераторы, которые завершаются при исчерпании входных данных</p>
<h3>accumulate</h3>
<p>Возвращает итератор, который вычисляет частичные суммы
(или другие накопленные функции, если указана) от переданного итератора</p>
<div class="code_element"><div class="lang_line"><text>python</text><button class="copy_code_button" onclick="CopyCode(this)"><svg width="1.2em" height="1.2em" viewBox="0 0 24 24"><use href="#icon_code_copy"/></svg><text class="unselectable">Copy code</text></button></div><div class="code language-python"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">accumulate</span>

<span class="nb">list</span><span class="p">(</span><span class="n">accumulate</span><span class="p">([</span><span class="mi">1</span><span class="k">,</span> <span class="mi">2</span><span class="k">,</span> <span class="mi">3</span><span class="k">,</span> <span class="mi">4</span><span class="p">]))</span>
<span class="c1"># [1, 3, 6, 10]</span>
</pre></div></div></div>

<h3>batched</h3>
<p>Разбивает iterable на последовательные блоки фиксированного размера
Последний блок может быть короче</p>
<p><strong>Python 3.12+</strong></p>
<div class="code_element"><div class="lang_line"><text>python</text><button class="copy_code_button" onclick="CopyCode(this)"><svg width="1.2em" height="1.2em" viewBox="0 0 24 24"><use href="#icon_code_copy"/></svg><text class="unselectable">Copy code</text></button></div><div class="code language-python"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">batched</span>

<span class="nb">list</span><span class="p">(</span><span class="n">batched</span><span class="p">(</span><span class="s2">&quot;ABCDEFG&quot;</span><span class="k">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="c1"># [(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;), (&quot;D&quot;, &quot;E&quot;, &quot;F&quot;), (&quot;G&quot;,)]</span>
</pre></div></div></div>

<h3>chain</h3>
<p>Принимает несколько итераторов и возвращает один итератор,
объединяющий все их элементы последовательно</p>
<div class="code_element"><div class="lang_line"><text>python</text><button class="copy_code_button" onclick="CopyCode(this)"><svg width="1.2em" height="1.2em" viewBox="0 0 24 24"><use href="#icon_code_copy"/></svg><text class="unselectable">Copy code</text></button></div><div class="code language-python"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">chain</span>

<span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span><span class="s2">&quot;ABC&quot;</span><span class="k">,</span> <span class="s2">&quot;DEF&quot;</span><span class="p">))</span>
<span class="c1"># [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;E&quot;, &quot;F&quot;]</span>
</pre></div></div></div>

<h3>compress</h3>
<p>Возвращает элементы из первого итератора,
где соответствующий элемент из второго итератора (маски) истинный</p>
<div class="code_element"><div class="lang_line"><text>python</text><button class="copy_code_button" onclick="CopyCode(this)"><svg width="1.2em" height="1.2em" viewBox="0 0 24 24"><use href="#icon_code_copy"/></svg><text class="unselectable">Copy code</text></button></div><div class="code language-python"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">compress</span>

<span class="nb">list</span><span class="p">(</span><span class="n">compress</span><span class="p">(</span><span class="s2">&quot;ABCDEF&quot;</span><span class="k">,</span> <span class="p">[</span><span class="mi">1</span><span class="k">,</span> <span class="mi">0</span><span class="k">,</span> <span class="mi">1</span><span class="k">,</span> <span class="mi">0</span><span class="k">,</span> <span class="mi">1</span><span class="k">,</span> <span class="mi">0</span><span class="p">]))</span>
<span class="c1"># [&quot;A&quot;, &quot;C&quot;, &quot;E&quot;]</span>
</pre></div></div></div>

<h3>dropwhile</h3>
<p>Возвращает элементы из итератора, начиная с первого элемента,
для которого условие становится ложным</p>
<div class="code_element"><div class="lang_line"><text>python</text><button class="copy_code_button" onclick="CopyCode(this)"><svg width="1.2em" height="1.2em" viewBox="0 0 24 24"><use href="#icon_code_copy"/></svg><text class="unselectable">Copy code</text></button></div><div class="code language-python"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">dropwhile</span>

<span class="nb">list</span><span class="p">(</span><span class="n">dropwhile</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="k">,</span> <span class="p">[</span><span class="mi">1</span><span class="k">,</span> <span class="mi">4</span><span class="k">,</span> <span class="mi">6</span><span class="k">,</span> <span class="mi">7</span><span class="p">]))</span>
<span class="c1"># [6, 7]</span>
</pre></div></div></div>

<h3>takewhile</h3>
<p>Возвращает элементы из итератора до тех пор, пока условие истинно</p>
<div class="code_element"><div class="lang_line"><text>python</text><button class="copy_code_button" onclick="CopyCode(this)"><svg width="1.2em" height="1.2em" viewBox="0 0 24 24"><use href="#icon_code_copy"/></svg><text class="unselectable">Copy code</text></button></div><div class="code language-python"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">takewhile</span>

<span class="nb">list</span><span class="p">(</span><span class="n">takewhile</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="k">,</span> <span class="p">[</span><span class="mi">1</span><span class="k">,</span> <span class="mi">4</span><span class="k">,</span> <span class="mi">6</span><span class="k">,</span> <span class="mi">7</span><span class="p">]))</span>
<span class="c1"># [1, 4]</span>
</pre></div></div></div>

<h3>filterfalse</h3>
<p>Возвращает элементы итератора, для которых условие ложно (противоположно <code>filter</code>)</p>
<div class="code_element"><div class="lang_line"><text>python</text><button class="copy_code_button" onclick="CopyCode(this)"><svg width="1.2em" height="1.2em" viewBox="0 0 24 24"><use href="#icon_code_copy"/></svg><text class="unselectable">Copy code</text></button></div><div class="code language-python"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">filterfalse</span>

<span class="nb">list</span><span class="p">(</span><span class="n">filterfalse</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span><span class="k">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)))</span>
<span class="c1"># [0, 2, 4, 6, 8]</span>
</pre></div></div></div>

<h3>groupby</h3>
<p>Группирует элементы последовательности по ключу (или значению функции)
Возвращает итератор с парами <code>(ключ, группа)</code></p>
<p>Работает только с подряд идущими элементами
Часто требуется предварительная сортировка</p>
<div class="code_element"><div class="lang_line"><text>python</text><button class="copy_code_button" onclick="CopyCode(this)"><svg width="1.2em" height="1.2em" viewBox="0 0 24 24"><use href="#icon_code_copy"/></svg><text class="unselectable">Copy code</text></button></div><div class="code language-python"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">groupby</span>

<span class="k">for</span> <span class="n">key</span><span class="k">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;AAAABBBCCDA&quot;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="k">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">group</span><span class="p">))</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A [&quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;A&quot;]</span>
<span class="sd">B [&quot;B&quot;, &quot;B&quot;, &quot;B&quot;]</span>
<span class="sd">C [&quot;C&quot;, &quot;C&quot;]</span>
<span class="sd">D [&quot;D&quot;]</span>
<span class="sd">A [&quot;A&quot;]</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div></div></div>

<h3>islice</h3>
<p>Возвращает срез итератора (аналогично <code>slice()</code> для списков)</p>
<div class="code_element"><div class="lang_line"><text>python</text><button class="copy_code_button" onclick="CopyCode(this)"><svg width="1.2em" height="1.2em" viewBox="0 0 24 24"><use href="#icon_code_copy"/></svg><text class="unselectable">Copy code</text></button></div><div class="code language-python"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">islice</span>

<span class="nb">list</span><span class="p">(</span><span class="n">islice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="k">,</span> <span class="mi">2</span><span class="k">,</span> <span class="mi">8</span><span class="k">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="c1"># [2, 4, 6]</span>
</pre></div></div></div>

<h3>pairwise</h3>
<p>Выдаёт пары соседних элементов из <code>iterable</code></p>
<div class="code_element"><div class="lang_line"><text>python</text><button class="copy_code_button" onclick="CopyCode(this)"><svg width="1.2em" height="1.2em" viewBox="0 0 24 24"><use href="#icon_code_copy"/></svg><text class="unselectable">Copy code</text></button></div><div class="code language-python"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">pairwise</span>

<span class="nb">list</span><span class="p">(</span><span class="n">pairwise</span><span class="p">(</span><span class="s2">&quot;ABcd12&quot;</span><span class="p">))</span>
<span class="c1"># [(&quot;A&quot;, &quot;B&quot;), (&quot;B&quot;, &quot;c&quot;), (&quot;c&quot;, &quot;d&quot;), (&quot;d&quot;, &quot;1&quot;), (&quot;1&quot;, &quot;2&quot;)]</span>
</pre></div></div></div>

<h3>starmap</h3>
<p>Применяет функцию к каждому элементу итератора, передавая элементы
как аргументы по позициям (аналогично <code>map()</code>, но с распаковкой аргументов)</p>
<div class="code_element"><div class="lang_line"><text>python</text><button class="copy_code_button" onclick="CopyCode(this)"><svg width="1.2em" height="1.2em" viewBox="0 0 24 24"><use href="#icon_code_copy"/></svg><text class="unselectable">Copy code</text></button></div><div class="code language-python"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">starmap</span>

<span class="nb">list</span><span class="p">(</span><span class="n">starmap</span><span class="p">(</span><span class="nb">pow</span><span class="k">,</span> <span class="p">[(</span><span class="mi">2</span><span class="k">,</span> <span class="mi">5</span><span class="p">)</span><span class="k">,</span> <span class="p">(</span><span class="mi">3</span><span class="k">,</span> <span class="mi">2</span><span class="p">)</span><span class="k">,</span> <span class="p">(</span><span class="mi">10</span><span class="k">,</span> <span class="mi">3</span><span class="p">)]))</span>
<span class="c1"># [32, 9, 1000]</span>
</pre></div></div></div>

<h3>tee</h3>
<p>Разделяет итератор на заданное количество независимых копий</p>
<p>Важно
tee буферизует данные в памяти при неравномерном потреблении итераторов</p>
<div class="code_element"><div class="lang_line"><text>python</text><button class="copy_code_button" onclick="CopyCode(this)"><svg width="1.2em" height="1.2em" viewBox="0 0 24 24"><use href="#icon_code_copy"/></svg><text class="unselectable">Copy code</text></button></div><div class="code language-python"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">tee</span>

<span class="n">it1</span><span class="k">,</span> <span class="n">it2</span> <span class="o">=</span> <span class="n">tee</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="k">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">list</span><span class="p">(</span><span class="n">it1</span><span class="p">)</span>
<span class="nb">list</span><span class="p">(</span><span class="n">it2</span><span class="p">)</span>
<span class="c1"># [0, 1, 2, 3, 4]</span>
<span class="c1"># [0, 1, 2, 3, 4]</span>
</pre></div></div></div>

<h3>zip_longest</h3>
<p>Объединяет элементы из нескольких итераторов, заполняя отсутствующие значения <code>fillvalue</code></p>
<div class="code_element"><div class="lang_line"><text>python</text><button class="copy_code_button" onclick="CopyCode(this)"><svg width="1.2em" height="1.2em" viewBox="0 0 24 24"><use href="#icon_code_copy"/></svg><text class="unselectable">Copy code</text></button></div><div class="code language-python"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">zip_longest</span>

<span class="nb">list</span><span class="p">(</span><span class="n">zip_longest</span><span class="p">(</span><span class="s2">&quot;AB&quot;</span><span class="k">,</span> <span class="s2">&quot;12&quot;</span><span class="k">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">))</span>
<span class="c1"># [(&quot;A&quot;, &quot;1&quot;), (&quot;B&quot;, &quot;2&quot;)]</span>
</pre></div></div></div>

<h2>Combinatoric generators</h2>
<p>Генераторы для комбинаторных последовательностей</p>
<h3>product</h3>
<p>Возвращает декартово произведение входных итераторов (все возможные комбинации)</p>
<div class="code_element"><div class="lang_line"><text>python</text><button class="copy_code_button" onclick="CopyCode(this)"><svg width="1.2em" height="1.2em" viewBox="0 0 24 24"><use href="#icon_code_copy"/></svg><text class="unselectable">Copy code</text></button></div><div class="code language-python"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">product</span>

<span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="s2">&quot;AB&quot;</span><span class="k">,</span> <span class="s2">&quot;12&quot;</span><span class="p">))</span>
<span class="c1"># [(&quot;A&quot;, &quot;1&quot;), (&quot;A&quot;, &quot;2&quot;), (&quot;B&quot;, &quot;1&quot;), (&quot;B&quot;, &quot;2&quot;)]</span>
</pre></div></div></div>

<h3>permutations</h3>
<p>Возвращает все возможные перестановки заданной длины (или длины итератора)</p>
<div class="code_element"><div class="lang_line"><text>python</text><button class="copy_code_button" onclick="CopyCode(this)"><svg width="1.2em" height="1.2em" viewBox="0 0 24 24"><use href="#icon_code_copy"/></svg><text class="unselectable">Copy code</text></button></div><div class="code language-python"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">permutations</span>

<span class="nb">list</span><span class="p">(</span><span class="n">permutations</span><span class="p">(</span><span class="s2">&quot;ABC&quot;</span><span class="k">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="c1"># [(&quot;A&quot;, &quot;B&quot;), (&quot;A&quot;, &quot;C&quot;), (&quot;B&quot;, &quot;A&quot;), (&quot;B&quot;, &quot;C&quot;), (&quot;C&quot;, &quot;A&quot;), (&quot;C&quot;, &quot;B&quot;)]</span>
</pre></div></div></div>

<h3>combinations</h3>
<p>Возвращает все возможные комбинации заданной длины из элементов итератора (без повторений)</p>
<div class="code_element"><div class="lang_line"><text>python</text><button class="copy_code_button" onclick="CopyCode(this)"><svg width="1.2em" height="1.2em" viewBox="0 0 24 24"><use href="#icon_code_copy"/></svg><text class="unselectable">Copy code</text></button></div><div class="code language-python"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">combinations</span>

<span class="nb">list</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="s2">&quot;ABC&quot;</span><span class="k">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="c1"># [(&quot;A&quot;, &quot;B&quot;), (&quot;A&quot;, &quot;C&quot;), (&quot;B&quot;, &quot;C&quot;)]</span>
</pre></div></div></div>

<h3>combinations_with_replacement</h3>
<p>Возвращает все возможные комбинации с повторениями заданной длины из элементов итератора</p>
<div class="code_element"><div class="lang_line"><text>python</text><button class="copy_code_button" onclick="CopyCode(this)"><svg width="1.2em" height="1.2em" viewBox="0 0 24 24"><use href="#icon_code_copy"/></svg><text class="unselectable">Copy code</text></button></div><div class="code language-python"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">combinations_with_replacement</span>

<span class="nb">list</span><span class="p">(</span><span class="n">combinations_with_replacement</span><span class="p">(</span><span class="s2">&quot;AB&quot;</span><span class="k">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="c1"># [(&quot;A&quot;, &quot;A&quot;), (&quot;A&quot;, &quot;B&quot;), (&quot;B&quot;, &quot;B&quot;)]</span>
</pre></div></div></div>