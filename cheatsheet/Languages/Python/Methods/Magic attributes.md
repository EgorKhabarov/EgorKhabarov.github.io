# locals()

| Переменная        | Описание                                                                                                  |
|-------------------|-----------------------------------------------------------------------------------------------------------|
| `__annotations__` | Словарь, содержащий аннотации типов, заданные в модуле<br>`def func(a: int, b: str) -> bool: pass`<br>`print(func.__annotations__)  # {'a': <class 'int'>, 'b': <class 'str'>, 'return': <class 'bool'>}` |
| `__builtins__`    | Ссылка на встроенные объекты Python, такие как функции (`len`, `print`) и исключения (`ValueError`)       |
| `__cached__`      | Указывает путь к закэшированному файлу `.pyc`, созданному для текущего модуля                             |
| `__doc__`         | Строка документации текущего модуля. Если документации нет, то значение будет `None`                      |
| `__file__`        | Путь к файлу, из которого был загружен текущий модуль                                                     |
| `__loader__`      | Объект, ответственный за загрузку текущего модуля                                                         |
| `__name__`        | Имя текущего модуля. Для основного исполняемого скрипта значение будет `'__main__'`                       |
| `__package__`     | Имя пакета, в котором находится модуль. Если модуль находится на верхнем уровне, то значение будет `None` |
| `__spec__`        | Спецификация загрузки модуля. Это объект, содержащий информацию о модуле, такой как его путь, имя и пакет |

# object

| Атрибут           | Описание                                                                                                                                                                                                                                                  | Пример использования                |
|-------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|
| `__code__`        | Содержит объект типа `code`, представляющий байт-код функции.<br>Можно использовать для анализа и изменения                                                                                                                                               | `func.__code__.co_varnames`         |
| `__closure__`     | Кортеж объектов `cell`, хранящих значения переменных,<br>захваченных замыканием (если функция использует замыкания)                                                                                                                                       | `func.__closure__[0].cell_contents` |
| `__module__`      | Имя модуля, в котором определена функция.<br>Полезно для понимания контекста определения функции                                                                                                                                                          | `func.__module__`                   |
| `__annotations__` | Словарь с аннотациями типов для аргументов функции и возвращаемого значения                                                                                                                                                                               | `func.__annotations__`              |
| `__globals__`     | Словарь глобальных переменных, доступных функции.<br>Позволяет доступ к глобальному пространству имен.<br>Если функция func была определена в модуле module,<br>то `func.__globals__` будет ссылаться<br>на глобальный символический словарь этого модуля | `func.__globals__["variable_name"]` |
| `__defaults__`    | Кортеж значений по умолчанию для позиционных<br>и именованных аргументов функции (если они определены)                                                                                                                                                    | `func.__defaults__`                 |
| `__kwdefaults__`  | Словарь значений по умолчанию для только ключевых аргументов функции (если они определены)                                                                                                                                                                | `func.__kwdefaults__`               |
| `__qualname__`    | Полное имя функции, включая контексты, такие как класс или модуль, в котором она определена                                                                                                                                                               | `func.__qualname__`                 |


## &#x5f;&#x5f;code&#x5f;&#x5f;

| Атрибут              | Описание                                                                                                                                                                                                                                                                                          | Пример использования                 |
|----------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|
| `co_argcount`        | Количество аргументов, принимаемых функцией (без `*args` и `**kwargs`)                                                                                                                                                                                                                            | `func.__code__.co_argcount`          |
| `co_cellvars`        | Кортеж с именами переменных, которые являются локальными, но используются в замыканиях                                                                                                                                                                                                            | `func.__code__.co_cellvars`          |
| `co_code`            | Сырые байт-коды, представляющие тело функции                                                                                                                                                                                                                                                      | `func.__code__.co_code`              |
| `co_consts`          | Кортеж с константами, используемыми в функции (например, числа, строки)                                                                                                                                                                                                                           | `func.__code__.co_consts`            |
| `co_exceptiontable`  | Таблица, описывающая обработку исключений в байт-коде.<br>Содержит информацию о try/except блоках и местах, где нужно ловить исключения                                                                                                                                                           | `func.__code__.co_exceptiontable`    |
| `co_filename`        | Имя файла, в котором определена функция                                                                                                                                                                                                                                                           | `func.__code__.co_filename`          |
| `co_firstlineno`     | Номер первой строки, содержащей исходный код функции                                                                                                                                                                                                                                              | `func.__code__.co_firstlineno`       |
| `co_flags`           | Флаги, описывающие состояние функции (например, использование генераторов)<br>Этот атрибут — битовая маска, содержащая информацию о функции, например,<br>используется ли функция как генератор, имеет ли она `*args` или `**kwargs` и т.д<br>Например, `0x20` указывает, что функция — генератор | `func.__code__.co_flags`             |
| `co_freevars`        | Кортеж с именами переменных, которые используются в функции,<br>но не являются локальными (замыкания)                                                                                                                                                                                             | `func.__code__.co_freevars`          |
| `co_kwonlyargcount`  | Количество ключевых-only аргументов                                                                                                                                                                                                                                                               | `func.__code__.co_kwonlyargcount`    |
| `co_lines`           | Итератор, который возвращает пары `(начало строки, конец строки)`<br>для каждого блока байт-кода, позволяя точно определить,<br>какая часть кода соответствует определенным строкам исходного кода                                                                                                | `list(func.__code__.co_lines())`     |
| `co_linetable`       | Байт-код таблицы, содержащей информацию о соответствии номеров строк исходному коду<br>(используется в интерпретаторе Python для трассировки)                                                                                                                                                     | `func.__code__.co_linetable`         |
| `co_lnotab`          | Содержит информацию для отображения байт-кодов в номера строк исходного кода                                                                                                                                                                                                                      | `func.__code__.co_lnotab`            |
| `co_name`            | Имя функции                                                                                                                                                                                                                                                                                       | `func.__code__.co_name`              |
| `co_names`           | Кортеж с именами всех объектов (функций, классов, переменных), используемых в функции                                                                                                                                                                                                             | `func.__code__.co_names`             |
| `co_nlocals`         | Количество локальных переменных, используемых в функции                                                                                                                                                                                                                                           | `func.__code__.co_nlocals`           |
| `co_positions`       | Итератор, возвращающий позиции в коде: `(start_line, start_col, end_line, end_col)`<br>для каждого выражения или инструкции в функции.<br>Это позволяет точно определить позиции в исходном коде                                                                                                  | `list(func.__code__.co_positions())` |
| `co_posonlyargcount` | Количество позиционных-only аргументов                                                                                                                                                                                                                                                            | `func.__code__.co_posonlyargcount`   |
| `co_qualname`        | Полное имя функции, включая контексты, такие как класс или модуль.<br>Полезно для определения квалифицированного имени метода класса или вложенной функции                                                                                                                                        | `func.__code__.co_qualname`          |
| `co_stacksize`       | Размер стека, необходимый для выполнения функции                                                                                                                                                                                                                                                  | `func.__code__.co_stacksize`         |
| `co_varnames`        | Кортеж с именами всех локальных переменных, включая аргументы функции                                                                                                                                                                                                                             | `func.__code__.co_varnames`          |
| `replace`            | Позволяет создать новый объект code, заменив выбранные атрибуты                                                                                                                                                                                                                                   | `func.__code__.replace(**kwargs)`    |

# Примеры использования

### Получение количества аргументов функции
```python
def example_func(a, b, c=10):
    return a + b + c

print(example_func.__code__.co_argcount)  # 2
```

### Извлечение имен аргументов и локальных переменных
```python
def example_func(x, y):
    z = x + y
    return z

print(example_func.__code__.co_varnames)  # ("x", "y", "z")
```

### Получение имени файла и строки, где определена функция
```python
def example_func():
    pass

print(example_func.__code__.co_filename)     # Имя файла, в котором определена функция
print(example_func.__code__.co_firstlineno)  # Номер первой строки
```

### Работа с байт-кодом
```python
def example_func(a, b):
    return a + b

print(example_func.__code__.co_code)  # Сырые байт-коды
```

### Константы, используемые в функции
```python
def example_func():
    x = 42
    return x

print(example_func.__code__.co_consts)  # (None, 42)
```

### Проверка использования замыканий
```python
def outer_func(x):
    def inner_func(y):
        return x + y
    return inner_func

closure_func = outer_func(10)
print(closure_func.__code__.co_freevars)  # ("x",)
print(closure_func.__code__.co_cellvars)  # ()
```



# Exception

[Подробнее про методы исключений](?Languages/Python/Built-in/Exception#методы-exception)

|                        |     |
|------------------------|-----|
| `__cause__`            | Используется для хранения "причины" исключения<br>На исключение, которое привело к текущему<br>Например, если одно исключение было вызвано другим (например, в процессе обработки ошибки), то "причина" может быть записана в `__cause__`<br>Когда возникает исключение в блоке `except` или при<br>повторном возбуждении исключений с помощью `raise ... from`
| `__context__`          | Хранит контекст, то есть исключение, которое возникло непосредственно перед текущим исключением,<br>но не обязательно является его причиной<br>Может быть полезен в сложных сценариях обработки ошибок, например, при вложенных `try-except`
| `__suppress_context__` | bool Указывает, следует ли подавить контекст при повторном возбуждении исключения<br>Если `True`, контекст (то есть `__context__`) не будет отображаться в traceback
| `__traceback__`        | Содержит объект traceback (трассировки стека), который связан с исключением<br>Используется для получения информации о стеке вызовов, где произошла ошибка
| `__notes__`            | Список строк, содержащих примечания, добавленные к исключению с помощью метода `add_note`

Магические методы `__cause__`, `__context__`, `__suppress_context__` и `__traceback__`
позволяют более гибко управлять цепочкой исключений, контекстом и трассировками, что особенно полезно при перехвате,
повторном возбуждении и обработке исключений.


### __context__

```pycon
>>> try:
...     try:
...         raise ValueError("Ошибка в вложенном блоке")
...     except ValueError as inner_exception:
...         raise KeyError("Ошибка внешнего блока") from inner_exception
... except KeyError as e:
...     print(f"Контекст ошибки: {e.__context__}")
Контекст ошибки: Ошибка в вложенном блоке
```


#### 3. **`__suppress_context__`**

- **Описание**: Это булев атрибут, который у. .
- **Применение**: Обычно используется в случае, если вы хотите исключить подробности предыдущих ошибок при повторном возбуждении исключений, чтобы они не появлялись в выводе трассировки.

##### Пример:
```python
try:
    try:
        raise ValueError("Ошибка в блоке")
    except ValueError as inner_exception:
        raise KeyError("Ошибка внешнего блока") from inner_exception
except KeyError as e:
    e.__suppress_context__ = True  # Подавляем контекст
    raise e
```

В этом примере, несмотря на то что контекст существует, он не будет отображаться в traceback.

---

#### 4. **`__traceback__`**

- **Применение**: Может быть полезен для отображения подробной информации о том, где произошла ошибка, или для передачи трассировки с одним исключением к другому.

##### Пример:
```python
try:
    raise ValueError("Произошла ошибка")
except ValueError as e:
    print(f"Traceback: {e.__traceback__} {dir(e.__traceback__)}")
```


# Атрибут `__weakref__`

- **Описание**: Этот атрибут позволяет объектам поддерживать слабые ссылки на себя. Если объект имеет атрибут `__weakref__`, это означает, что он может быть включён в слабую ссылку, что предотвращает цикл ссылок, и объект может быть удалён сборщиком мусора, даже если на него существуют ссылки.

- **Применение**: Используется для предотвращения удержания объектов в памяти, если они больше не нужны, и для работы с кэшами или другими объектами, где нужно контролировать жизненный цикл объектов.

#### Пример:
```python
import weakref

class MyClass:
    def __del__(self):
        print("Объект удален")

obj = MyClass()
weak_obj = weakref.ref(obj)

# Прямая ссылка
print(weak_obj())  # Выведет объект

del obj  # Удаление объекта

print(weak_obj())  # Выведет None, так как объект удален
```
