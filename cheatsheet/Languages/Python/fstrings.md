# F-Strings

**F-строки** - это новый способ форматирования строк в Python 3.6 и выше.
Они позволяют встраивать выражения Python внутри строк посредством указания их в `{}` внутри строки, заключенной в `f`.

```ebnf
replacement_field ::=  "{" [field_name] ["!" conversion] [":" format_spec] "}"

field_name        ::=  arg_name ("." attribute_name | "[" element_index "]")*
arg_name          ::=  [identifier | digit+]
attribute_name    ::=  identifier
element_index     ::=  digit+ | index_string
index_string      ::=  <любой исходный символ, кроме "]"> +

conversion        ::=  "r" | "s" | "a"

format_spec       ::=  [[fill]align][sign][#][0][width][grouping_option][.precision][type]
fill              ::=  <any character>
align             ::=  "<" | ">" | "=" | "^"
sign              ::=  "+" | "-" | " "
width             ::=  digit+
grouping_option   ::=  "_" | ","
precision         ::=  digit+
type              ::=  "b" | "c" | "d" | "e" | "E" | "f" | "F" | "g" | "G" | "n" | "o" | "s" | "x" | "X" | "%"
```

## Field_name

Выражение формы `".name"` выбирает именованный атрибут с помощью `getattr()`
Выражение формы `"[index]"` выполняет поиск по индексу с использованием `getitem()`


## Conversion

Вызывает приведение типа перед форматированием

| conversion |         |
|:----------:|---------|
| `!s`       | str()   |
| `!r`       | repr()  |
| `!a`       | ascii() |
| `!e`       | **Python 3.12** |


## Format_spec

Содержит спецификацию того, как должно быть представлено значение,
Включая такие детали, как ширина поля, выравнивание, заполнение, десятичная точность и т. д.
Каждый тип значения может определять свой собственный **мини-язык форматирования** или интерпретацию `format_spec`.

### Fill

Невозможно использовать литеральную фигурную скобку `{` или `}` в качестве символа `fill`
в форматированном строковом литерале или при использовании метода `str.format()`.
<details>
    <summary><b>Однако можно вставить фигурную скобку с вложенным полем замены.</b></summary>
```pycon
>>> f"{1:}>20}"
  File "<stdin>", line 1
    f"{1:}>20}"
               ^
SyntaxError: f-string: single '}' is not allowed
>>> f"{1:}}>20}"
  File "<stdin>", line 1
    f"{1:}}>20}"
                ^
SyntaxError: f-string: single '}' is not allowed
>>> f"{1:{'}'}>20}"
"}}}}}}}}}}}}}}}}}}}1"```
</details>
Это ограничение не влияет на функцию `format()`.


### Align

| Вариант        | Значение |
|:--------------:|----------|
| **`<`**        | Выравнивает поле по левому краю в доступном пространстве<br>**По умолчанию для большинства объектов** |
| **`>`**        | Принудительно выравнивает поле по правому краю в доступном пространстве<br>**По умолчанию для чисел** |
| **`^`**        | Центрирует поле в доступном пространстве |


### Sign

Действителен только для числовых типов.

| Вариант        | Значение |
|:--------------:|----------|
| **`+`**          | Указывает, что знак должен использоваться как для положительных, так и для отрицательных чисел                                                                                                                                                                                                                       |
| **`-`**          | Указывает, что знак следует использовать только для отрицательных чисел<br>**Поведение по умолчанию**                                                                                                                                                                                                                 |
| **`=`**          | Принудительно размещает заполнение после знака (если есть), но перед цифрами.<br>Это используется для печати полей в форме `+000000120`.<br>Этот параметр выравнивания действителен только для числовых типов.<br>Он становится значением по умолчанию для чисел, когда `0` непосредственно предшествует ширине поля |
| **__Пробел__** | Указывает, что ведущий пробел должен использоваться на положительных числах, а знак минус на отрицательных числах                                                                                                                                                                                                    |


### &#x23;

**#** - Приводит к использованию **альтернативной формы** для преобразования.
    Альтернативная форма определяется по-разному для разных типов.
    Этот параметр действителен только для **целых**, **плавающих** и **сложных** типов.
    Для целых чисел, когда используется **двоичный**, **восьмеричный** или **шестнадцатеричный** вывод,
    эта опция добавляет соответствующий префикс `0b`, `0o`, `0x` или `0X` к выходному значению.<br>
    Для чисел с **плавающей запятой** и **сложных** альтернативная форма приводит к тому, что результат
    преобразования всегда содержит символ десятичной точки, **даже если за ним не следуют цифры**.
    Обычно символ десятичной точки появляется в результате этих преобразований только в том случае, если за ним следует цифра.
    **Кроме того, для преобразований `g` и `G` конечные нули не удаляются из результата.**


### 0

**,** - Сигнализирует об использовании запятой для разделителя тысяч.
    Для разделителя с учётом языкового стандарта использовать вместо него целочисленный тип представления `n`
**_** - Сигнализирует об использовании подчеркивания для разделителя тысяч для типов представления с плавающей запятой
    и для целочисленного типа представления `d`.
    Для целочисленных типов представления `b`, `o`, `x` и `X` символы подчеркивания вставляются каждые 4 цифры.
    Для других типов представлений указание этой опции является ошибкой.


### Width

Десятичное целое число, определяющее минимальную общую ширину поля,
включая любые префиксы, разделители и другие символы форматирования.
Если не указан, то ширина поля будет определяться содержимым.

Если явное выравнивание не задано, то перед полем `width` нулевым `0` символом
включается знаковое заполнение нулями для числовых типов.
Это эквивалентно `fill` символу `0` с типом alignment `=`.

Точность представляет собой десятичное целое число , указывающее, сколько цифр должно отображаться после десятичной
точки для типов представления `f` и `F`, или до и после десятичной точки для типов представления `g` или `G`.
Для типов строкового представления поле указывает максимальный размер поля, другими словами, сколько символов
будет использовано из содержимого поля. Точность не допускается для целочисленных типов представления .


### Precision

Десятичное число, указывающее, сколько цифр должно отображаться после десятичной точки
для значения с плавающей запятой, отформатированного с помощью `f` и `F`,
или до и после десятичной точки для значения с плавающей запятой, отформатированного с помощью `g` или `G`.
Для нечисловых типов поле указывает максимальный размер поля — другими словами,
сколько символов будет использовано из содержимого поля.
`precision` не допускается для целочисленных значений.


### Type

Определяет, как данные должны быть представлены.

#### 1. Доступные типы представления строк

| Тип   | Значение |
|:-----:|----------|
| `s` | Формат строки. Это тип по умолчанию для строк, и его можно опустить |
| None  | То же, что `s` |


#### 2. Доступные типы целочисленного представления

| Тип   | Значение |
|:-----:|----------|
| **`b`** | Двоичный формат |
| **`c`** | Преобразует целое число в соответствующий символ Юникода перед печатью |
| **`d`** | Десятичное целое число |
| **`o`** | Восьмеричный формат |
| **`x`** | Шестнадцатеричный формат. Использует строчные буквы для цифр выше `9` |
| **`X`** | Шестнадцатеричный формат. Использует прописные буквы для цифр выше `9` |
| **`n`** | Число. Это то же самое, что и `d`, за исключением того,<br>что для вставки соответствующих символов-разделителей чисел он использует текущую настройку локали |
| None  | То же, что `d` |

#### 3. Доступные типы представления для `float` и `Decimal` значений

| Тип      | Значение |
|:--------:|----------|
| **`e`**    | Научная нотация.<br>Для заданной точности `p` форматирует число в **экспоненциальном представлении** с буквой «`e`», отделяющей **`p` цифр коэффициента** от экспоненты.<br>Коэффициент состоит из одной цифры перед и после десятичной точки, всего `p + 1` значащих цифр.<br>Если точность не указана, используется точность **6 цифр** после десятичной точки для `float`<br>и отображаются все цифры коэффициентов для `Decimal`.<br>Если после десятичной точки нет цифр, десятичная точка также удаляется,<br>если не используется опция `#` |
| **`E`**    | Научная нотация.<br>То же, что и `e`, за исключением того, что в качестве символа-разделителя используется заглавная буква «`E`» |
| **`f`**    | Запись с фиксированной точкой.<br>Для заданной точности `p` форматирует число как десятичное с точностью `p` цифр после десятичной точки.<br>Если точность не указана, используется точность **6 цифр** после десятичной точки для `float`<br>и используется точность, достаточно большая для отображения всех цифр коэффициентов для `Decimal`.<br>Если после десятичной точки нет цифр, десятичная точка также удаляется,<br>если не используется опция `#` |
| **`F`**    | Представление с фиксированной точкой.<br>То же, что и `f`, но преобразует `nan` в `NAN` и `inf` в `INF` |
| **`g`**    | Общий формат.<br>Для заданной точности `p >= 1` округляет число до `p` значащих цифр и затем форматирует результат либо в формате с фиксированной точкой,<br>либо в научном представлении, в зависимости от его величины.<br><br>Точные правила следующие: предположим, что результат отформатирован с типом представления `e` и `p-1` точности, будет с exp экспонентой.<br>Затем, если `m <= exp < p`, где `m` равно `-4` для `floats` и `-6` для `Decimals`,<br>число форматируется с типом представления `f` и точностью `p-1-exp`.<br>В противном случае номер форматируется с помощью `e` типа представления и `p-1` точности.<br>В обоих случаях из значащего удаляются незначительные конечные нули, а десятичная точка также удаляется, если после неё нет оставшихся цифр,<br>если не используется опция `#`.<br><br>Без указания точности использует точность **`6` значащих цифр** для `float`.<br>Для `Decimal` коэффициент результата формируется из цифр коэффициента значения;<br>экспоненциальная нотация используется для значений, меньших, чем `1e-6` по абсолютной величине, и значений,<br>в которых разряд наименее значащей цифры больше 1, а в противном случае используется нотация с фиксированной точкой.<br><br>Положительные и отрицательные бесконечности, положительный и отрицательный ноль и `nan`,<br>форматируются как `inf`, `-inf`, `0`, `-0` и `nan` соответственно, независимо от точности |
| **`G`**    | Общий формат.<br>То же, что и `g`, за исключением переключения на `E`, если число становится слишком большим.<br>Представления бесконечности и `NaN` также в верхнем регистре |
| **`n`**    | Номер.<br>Это то же самое, что и `g`, за исключением того, что он использует текущую настройку локали<br>для вставки соответствующих символов разделителя чисел |
| **`%`**    | Процент.<br>**Умножает число на `100` и отображает в фиксированном `f` формате**, за которым следует знак процента |
| **None** | Для `float` это то же самое, что и для `g`,<br>за исключением того, что когда для форматирования результата используется запись с фиксированной точкой,<br>она всегда включает как минимум одну цифру после десятичной точки.<br>Используемая точность настолько велика, насколько это необходимо для точного представления заданного значения.<br><br>Для Decimal это то же самое, что `g` или `G` в зависимости от значения `context.capitals` для текущего десятичного контекста.<br><br>Общий эффект заключается в том, чтобы соответствовать выходным данным `str()`, измененному другими модификаторами формата |


Примеры простых форматных строк:
```python
"Сначала посчитай до {0}"         # Ссылки на первый позиционный аргумент
"Принеси мне {}"                  # Неявно ссылается на первый позиционный аргумент
"От {} до {}"                     # То же, что "От {0} до {1}"
"Мой квест {name}"                # Ссылка на ключевой аргумент «name»
"Масса в тоннах {0.weight}"       # атрибут «weight» первого позиционного аргумента
"Уничтожено единиц: {players[0]}" # Первый элемент ключевого аргумента «players».

"Гарольд умный {0!s}"             # Сначала вызывает str() для первого аргумента
"Принесите святую {name!r}"       # Сначала вызывает repr() для первого аргумента
"Больше {!a}"                     # Сначала вызывает ascii() для первого аргумента
```


Доступ к аргументам по позиции:

```pycon
>>> "{0}, {1}, {2}".format("a", "b", "c")
"a, b, c"
>>> "{}, {}, {}".format("a", "b", "c")  # 3.1+ python version only
"a, b, c"
>>> "{2}, {1}, {0}".format("a", "b", "c")
"c, b, a"
>>> "{2}, {1}, {0}".format(*"abc")      # unpacking argument sequence
"c, b, a"
>>> "{0}{1}{0}".format("abra", "cad")   # arguments indices can be repeated
"abracadabra"
```

Доступ к аргументам по имени:

```pycon
>>> "Coordinates: {latitude}, {longitude}".format(latitude="37.24N", longitude="-115.81W")
"Coordinates: 37.24N, -115.81W"
>>> coord = {"latitude": "37.24N", "longitude": "-115.81W"}
>>> "Coordinates: {latitude}, {longitude}".format(**coord)
"Coordinates: 37.24N, -115.81W"
```

Доступ к атрибутам аргументов:

```pycon
>>> c = 3-5j
>>> (
...     "The complex number {0} is formed from the real part {0.real} "
...     "and the imaginary part {0.imag}."
... ).format(c)
"The complex number 3-5j is formed from the real part 3.0 and the imaginary part -5.0."
```
```pycon
>>> class Point:
...     def __init__(self, x, y):
...         self.x, self.y = x, y
...     def __str__(self):
...         return "Point({self.x}, {self.y})".format(self=self)
...
>>> str(Point(4, 2))
"Point(4, 2)"
```

Доступ к элементам аргументов:

```pycon
>>> "X: {0[0]};  Y: {0[1]}".format((3, 5))
"X: 3;  Y: 5"
```
Замена `%s` и `%r`:
```pycon
>>> "repr() shows quotes: {!r}; str() doesn't: {!s}".format("test1", "test2")
"repr() shows quotes: 'test1'; str() doesn't: test2"
```

Выравнивание текста и указание ширины:

```pycon
>>> "{:<30}".format("left aligned")
"left aligned                  "
>>> "{:>30}".format("right aligned")
"                 right aligned"
>>> "{:^30}".format("centered")
"           centered           "
>>> "{:*^30}".format("centered")  # use "*" as a fill char
"***********centered***********"
```

Замена `%+f`, `%-f`, и и указание знака: `%` `f`

```pycon
>>> "{:+f}; {:+f}".format(3.14, -3.14)  # show it always
"+3.140000; -3.140000"
>>> "{: f}; {: f}".format(3.14, -3.14)  # show a space for positive numbers
" 3.140000; -3.140000"
>>> "{:-f}; {:-f}".format(3.14, -3.14)  # show only the minus -- same as "{:f}; {:f}"
"3.140000; -3.140000"
>>> 
>>> "{:-.2f}; {:-.2f}".format(3.14, -3.14)
"3.14; -3.14"
```

Замена `%x` и `%o` преобразование значения в разные базы:

```pycon
>>> # format also supports binary numbers
>>> "int: {0:d};  hex: {0:x};  oct: {0:o};  bin: {0:b}".format(42)
"int: 42;  hex: 2a;  oct: 52;  bin: 101010"
>>> # with 0x, 0o, or 0b as prefix:
>>> "int: {0:d};  hex: {0:#x};  oct: {0:#o};  bin: {0:#b}".format(42)
"int: 42;  hex: 0x2a;  oct: 0o52;  bin: 0b101010"
```

Использование запятой или подчёркивания в качестве разделителя тысяч:

```pycon
>>> "{:,}".format(1234567890)
"1,234,567,890"
>>> "{:_}".format(1234567890)
"1_234_567_890"
```

Выражение процента:

```pycon
>>> points, total = 19, 22
>>> "Correct answers: {:.2%}".format(points/total)
"Correct answers: 86.36%"
```

Использование форматирования для конкретного типа:

```pycon
>>> from datetime import datetime
>>> "{:%Y-%m-%d %H:%M:%S}".format(datetime(2010, 7, 4, 12, 15, 58))
"2010-07-04 12:15:58"
```

Вложенные аргументы и более сложные примеры:

```pycon
>>> for align, text in zip("<^>", ["left", "center", "right"]):
...    "{0:{fill}{align}16}".format(text, fill=align, align=align)
...
"left<<<<<<<<<<<<"
"^^^^^center^^^^^"
">>>>>>>>>>>right"
>>> octets = [192, 168, 0, 1]
>>> "{:02X}{:02X}{:02X}{:02X}".format(*octets)
"C0A80001"
>>> int(_, 16)
3232235521
>>> width = 5
>>> for num in range(5,12):
...     for base in "dXob":
...         print("{0:{width}{base}}".format(num, base=base, width=width), end=" ")
...     print()
... 
    5     5     5   101
    6     6     6   110
    7     7     7   111
    8     8    10  1000
    9     9    11  1001
   10     A    12  1010
   11     B    13  1011
```

Форматирование чисел:
Для вывода количества знаков после запятой можно использовать флаг f:

```pycon
>>> f"pi {22 / 7:.2f}"
"pi 3.14"
```

Форматирование строк:

```pycon
>>> name = "Name"
>>> f"{name.upper():<10}"  # выравнивается в лево на 10 символов
"NAME      "
>>> f"{name.upper():>10}"  # выравнивается в право на 10 символов
"      NAME"
>>> f"{name.upper():^10}"  # выравнивается по центру шириной 10 символов
"   NAME   "
>>> f"{22 / 7:>10.2f}"     # выравнивает в право на 10 и оставляет два знака после точки
"      3.14"
```

Форматирование строк может быть улучшено с помощью флагов:

```pycon
>>> f"{name.upper():=^10}"  # centered with 10 characters width and filled with "="
"===NAME==="
```

```python
>>> class Person:
...     def __format__(self, format_spec):
...         return "Person Object"
... 
>>> p = Person()
>>> print(f"{p}")
Person Object
```

```pycon
>>> import string
>>> class PluralFormatter(string.Formatter):
...     def format_field(self, value, format_spec):
...         if format_spec.startswith("plural,"):
...             words = format_spec.split(",")
...             if value == 1:
...                 return words[1]
...             else:
...                 return words[2]
...         else:
...             return super().format_field(value, format_spec)
...
>>> fmt = PluralFormatter()
>>> msg = "{0} {0:plural,bottle,bottles} on the wall"
>>> for bottle_count in (99, 3, 2, 1, 0):
...     print(fmt.format(msg, bottle_count))
... 
99 bottles on the wall
3 bottles on the wall
2 bottles on the wall
1 bottle on the wall
0 bottles on the wall
```

Взято из [https://digitology.tech/docs/python_3/library/string.html](https://digitology.tech/docs/python_3/library/string.html)

# % strings

|    |                                              |
|:--:|:---------------------------------------------|
| %s | Строковое представление                      |
| %d | Целое число                                  |
| %f | Число с плавающей точкой                     |
| %x | Шестнадцатеричное представление целого числа |
| %o | Восьмеричное представление целого числа      |
