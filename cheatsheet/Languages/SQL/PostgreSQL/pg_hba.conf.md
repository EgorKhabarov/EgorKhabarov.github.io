```bash
notepad "C:/Program Files/PostgreSQL/16/data/pg_hba.conf"
```

```bash
net stop postgresql-x64-16
net start postgresql-x64-16
```

# Запись может быть сделана в одном из семи форматов

> local     База Пользователь                   Метод-аутентификации \[Параметры-аутентификации]
> host      База Пользователь Адрес             Метод-аутентификации \[Параметры-аутентификации]
> hostssl   База Пользователь Адрес             Метод-аутентификации \[Параметры-аутентификации]
> hostnossl База Пользователь Адрес             Метод-аутентификации \[Параметры-аутентификации]
> host      База Пользователь IP-адрес IP-маска Метод-аутентификации \[Параметры-аутентификации]
> hostssl   База Пользователь IP-адрес IP-маска Метод-аутентификации \[Параметры-аутентификации]
> hostnossl База Пользователь IP-адрес IP-маска Метод-аутентификации \[Параметры-аутентификации]


### local

`local`
Unix-сокеты

### host

`host`
Подключения по `TCP/IP`
С `SSL` и без `SSL`

### hostssl

`hostssl`
Подключения по `TCP/IP` с применением шифрования `SSL`

### hostnossl

`hostnossl`
Противоположен `hostssl`
Подключения по `TCP/IP` без шифрования `SSL`

### База

- `all` - Все базы данных
- `sameuser` - Имя запрашиваемой базы данных совпадает с именем запрашиваемого пользователя
- `samerole` - Запрашиваемый пользователь должен быть членом роли с таким же именем, как и у запрашиваемой базы данных
- (`samegroup` - Это устаревший, но допустимый вариант значения `samerole`)
- Суперпользователи не становятся членами роли автоматически из-за `samerole`, а только если они являются явными членами роли, прямо или косвенно, и не только из-за того, что они суперпользователи
- `replication` - Если запрашивается подключение для физической репликации (для таких подключений не выбирается какая-то конкретная база данных)
- Любое другое значение воспринимается как имя определённой базы `Postgres Pro`
- Несколько имён баз данных можно указать, разделяя их запятыми
- Файл, содержащий имена баз данных, можно указать, поставив знак `@` в начале его имени

### Пользователь

- `all` - все пользователи
- Имя группы начинается с `+`
- (В `Postgres Pro` нет никакой разницы между пользователем и группой; знак + означает «совпадение любых ролей, которые прямо или косвенно являются членами роли», тогда как имя без знака `+` является подходящим только для этой конкретной роли)
- Суперпользователь рассматривается как член роли, только если он явно является членом этой роли, прямо или косвенно, а не только потому, что он является суперпользователем
- Несколько имён пользователей можно указать, разделяя их запятыми
- Файл, содержащий имена пользователей, можно указать, поставив знак `@` в начале его имени

### Адрес

`ip`/`mask`
- `all` - Любой IP-адрес
- `samehost` - Любые IP-адреса данного сервера
- `samenet` - Любой адрес любой подсети, к которой сервер подключён напрямую
- Имени, начинающееся с точки `.`, соответствует суффиксу актуального имени узла
- Так `.example.com` будет соответствовать `foo.example.com` (а не только `example.com`)
- Это поле применимо только к записям `host`, `hostssl` и `hostnossl`

### Метод-аутентификации

- `trust` - Разрешает безусловное подключение
Этот метод позволяет тому, кто может подключиться к серверу с базой данных `Postgres Pro`,
войти под любым желаемым пользователем `Postgres Pro` без введения пароля и без какой-либо другой аутентификации
[Подробности](https://postgrespro.ru/docs/postgrespro/10/auth-methods#AUTH-TRUST)
- `reject` - Отклоняет подключение безусловно
Полезна для фильтрации некоторых серверов группы, например, строка `reject` может отклонить попытку подключения одного компьютера,
при этом следующая строка позволяет подключиться остальным компьютерам в той же сети
- `scram-sha-256` Проверяет пароль пользователя, производя аутентификацию `SCRAM-SHA-256`
[Подробности](https://postgrespro.ru/docs/postgrespro/10/auth-methods#AUTH-PASSWORD)
- `md5` Проверяет пароль пользователя, производя аутентификацию `SCRAM-SHA-256` или `MD5`
[Подробности](https://postgrespro.ru/docs/postgrespro/10/auth-methods#AUTH-PASSWORD)
- `password` Требует для аутентификации введения клиентом незашифрованного пароля
Поскольку пароль посылается простым текстом через сеть, такой способ не стоит использовать, если сеть не вызывает доверия
[Подробности](https://postgrespro.ru/docs/postgrespro/10/auth-methods#AUTH-PASSWORD)
- `gss` Для аутентификации пользователя использует `GSSAPI`
Этот способ доступен только для подключений по `TCP/IP`
[Подробности](https://postgrespro.ru/docs/postgrespro/10/auth-methods#GSSAPI-AUTH)
- `sspi` Для аутентификации пользователя использует `SSPI`
Способ доступен только для `Windows`
[Подробности](https://postgrespro.ru/docs/postgrespro/10/auth-methods#SSPI-AUTH)
- `ident` Получает имя пользователя операционной системы клиента, связываясь с сервером `Ident`,
и проверяет, соответствует ли оно имени пользователя базы данных
Аутентификация ident может использоваться только для подключений по `TCP/IP`
Для локальных подключений применяется аутентификация peer
[Подробности](https://postgrespro.ru/docs/postgrespro/10/auth-methods#AUTH-IDENT)
- `peer` Получает имя пользователя операционной системы клиента из операционной системы и проверяет, соответствует ли оно имени пользователя запрашиваемой базы данных
Доступно только для локальных подключений
[Подробности](https://postgrespro.ru/docs/postgrespro/10/auth-methods#AUTH-PEER)
- `ldap` Проводит аутентификацию, используя сервер `LDAP`
[Подробности](https://postgrespro.ru/docs/postgrespro/10/auth-methods#AUTH-LDAP)
- `radius` Проводит аутентификацию, используя сервер `RADIUS`
[Подробности](https://postgrespro.ru/docs/postgrespro/10/auth-methods#AUTH-RADIUS)
- `cert` Проводит аутентификацию, используя клиентский сертификат `SSL`
[Подробности](https://postgrespro.ru/docs/postgrespro/10/auth-methods#AUTH-CERT)
- `pam` Проводит аутентификацию, используя службу подключаемых модулей аутентификации `PAM`, предоставляемую операционной системой
[Подробности](https://postgrespro.ru/docs/postgrespro/10/auth-methods#AUTH-PAM)
- `bsd` Проводит аутентификацию, используя службу аутентификации `BSD`, предоставляемую операционной системой
[Подробности](https://postgrespro.ru/docs/postgrespro/10/auth-methods#AUTH-BSD)

### Параметры-аутентификации

`имя=значение`
`clientcert` можно задать в любой записи hostssl
Если он равен `1`, клиент должен представить подходящий (доверенный) сертификат `SSL`, в дополнение к другим требованиям метода проверки подлинности


> Удалённое соединение по `TCP/IP` невозможно, если сервер запущен без определения соответствующих значений
> для параметра конфигурации `listen_addresses`, поскольку по умолчанию система принимает подключения по `TCP/IP`
> только для локального адреса замыкания `localhost`

[https://postgrespro.ru/docs/postgrespro/10/auth-pg-hba-conf](https://postgrespro.ru/docs/postgrespro/10/auth-pg-hba-conf)
