# Regular expression (RegExp)

Регуля́рные выраже́ния - формальный язык, используемый в компьютерных программах, работающих с текстом, для поиска и осуществления манипуляций с подстроками в тексте, основанный на использовании метасимволов
Для поиска используется строка-образец, состоящая из символов и метасимволов и задающая правило поиска

# Обозначения

|        |                                                                                                                                                                                                                                              |
|--------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `.`    | Один любой символ, кроме новой строки `\n`                                                                                                                                                                                                   |
| `\d`   | Любая цифра ≈`[0-9]`                                                                                                                                                                                                                         |
| `\D`   | Любой символ, кроме цифры ≈`[^0-9]`                                                                                                                                                                                                          |
| `\s`   | Любой пробельный символ (пробел, табуляция, конец строки и т.п.) ≈`[ \f\n\r\t\v]`                                                                                                                                                            |
| `\S`   | Любой не пробельный символ                                                                                                                                                                                                                   |
| `\w`   | Любая буква (то, что может быть частью слова), а также цифры и `_`                                                                                                                                                                           |
| `\W`   | Любая не-буква, не-цифра и не подчёркивание                                                                                                                                                                                                  |
| `[ ]`  | Один из символов в скобках, а также любой символ из диапазона `a-z` `0-9`<br>Буква `ё` не включается в общий диапазон букв!<br>Если нужен минус, его нужно указать последним или первым<br>Внутри скобок нужно экранировать только `]` и `\` |
| `[^ ]` | Любой символ, кроме перечисленных                                                                                                                                                                                                            |
| `^`    | Начало всего текста или начало строчки текста, если `flags=re.MULTILINE`                                                                                                                                                                     |
| `$`    | Конец всего текста или конец строчки текста, если `flags=re.MULTILINE`                                                                                                                                                                       |
| `\A`   | Строго начало всего текста                                                                                                                                                                                                                   |
| `\Z`   | Строго конец всего текста                                                                                                                                                                                                                    |
| `\b`   | Начало или конец слова (слева пусто или не-буква, справа буква и наоборот)                                                                                                                                                                   |
| `\B`   | Не граница слова: либо и слева, и справа буквы, либо и слева, и справа НЕ буквы                                                                                                                                                              |

# Квантификаторы

Квантификатор - специальный ограничитель, который указывает количество возможных повторений символа, группы символов или класса символов, находящихся в регулярном выражении перед ним

|                                            |                                                                                                                                                                                 |
|--------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `{n}`                                      | Ровно `n` повторений                                                                                                                                                            |
| `{m,n}`                                    | От `m` до `n` повторений включительно                                                                                                                                           |
| `{m,}`                                     | Не менее `m` повторений                                                                                                                                                         |
| `{,n}`                                     | Не более `n` повторений                                                                                                                                                         |
| `?`                                        | Ноль или одно вхождение, синоним `{0,1}`                                                                                                                                        |
| `*`                                        | Ноль или более, синоним `{0,}`                                                                                                                                                  |
| `+`                                        | Одно или более, синоним `{1,}`                                                                                                                                                  |
| `*?` `+?` `??`<br>`{m,n}?` `{,n}?` `{m,}?` | По умолчанию квантификаторы жадные - захватывают максимально возможное число символов<br>Добавление `?` делает их ленивыми, они захватывают минимально возможное число символов |

# Условные выражения

| Условное выражение |                                                                          | Регулярка            | Соответствие                                                                                                                                                                                                                                                  |
|--------------------|--------------------------------------------------------------------------|----------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `(?=.)`            | Позитивный просмотр вперёд                                               | `Людовик(?=XVI)`     | ЛюдовикXV, <span style="background-color: #999999;color: marktext;">Людовик</span>XVI, <span style="background-color: #999999;color: marktext;">Людовик</span>XVIII, ЛюдовикLXVII, ЛюдовикXXL                                                                 |
| `(?!.)`            | Негативный просмотр вперёд                                               | `Людовик(?!XVI)`     | <span style="background-color: #999999;color: marktext;">Людовик</span>XV, ЛюдовикXVI, ЛюдовикXVIII, <span style="background-color: #999999;color: marktext;">Людовик</span>LXVII, <span style="background-color: #999999;color: marktext;">Людовик</span>XXL |
| `(?<=.)`           | Позитивный просмотр назад<br>**Длина шаблона должна быть фиксированной** | `(?<=Сергей )Иванов` | Сергей <span style="background-color: #999999;color: marktext;">Иванов</span>, Игорь Иванов                                                                                                                                                                   |
| `(?<!.)`           | Негативный просмотр назад<br>**Длина шаблона должна быть фиксированной** | `(?<!Сергей )Иванов` | Сергей Иванов, Игорь <span style="background-color: #999999;color: marktext;">Иванов</span>                                                                                                                                                                   |

# Группы захвата

| Группа захвата      | Название                                                                                                                                        | Регулярка/Соответствие                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|---------------------|-------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `(?:pattern)`       | Незахватывающая группа                                                                                                                          | <code>(?:abc\|def)</code><br>123 <span style="background-color: #999999;color: marktext;">abc</span> 456                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `(pattern)`         | Неименованная группа захвата                                                                                                                    | `(123)`<br>0<span style="background-color: #999999;color: marktext;">123</span>4<br><div class="code" style="border-radius:.375rem .375rem;"><div class="highlight"><pre><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;0(123)4&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;01234&quot;</span><span class="p">)</span><br><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># 123</span><br><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>        <span class="c1"># 123</span><br><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># 01234</span><br><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>        <span class="c1"># 01234</span><br><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>   <span class="c1"># 01234</span><br></pre></div></pre></div></div> |
| `\1`                | Неименованная обратная ссылка<br>Позволяет ссылаться на ранее<br>захваченные группы<br>по номеру порядка их появления<br>в регулярном выражении | `(\d+)-\1`<br>1 <span style="background-color: #999999;color: marktext;">1-1</span> <span style="background-color: #999999;color: marktext;">123-123</span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `(?P<name>pattern)` | Именованная группа захвата                                                                                                                      | `My name is (?P<name>\w+)`<br>My name is <span style="background-color: #999999;color: marktext;">John</span><br><div class="code" style="border-radius:.375rem .375rem;"><div class="highlight"><pre><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;My name is (?P&lt;name&gt;\w+)&quot;</span><span class="p">)</span> \<br><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;My name is John&quot;</span><span class="p">)</span><br><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>  <span class="c1"># John</span><br><span class="n">m</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>        <span class="c1"># John</span><br></pre></div></pre></div></div>                                                                                                                                                                                                                                                                                                                                                                              |
| `(?P=name)`         | Именованная обратная ссылка<br>Позволяет ссылаться на ранее<br>захваченные группы по имени                                                      | `(?P<word>\w+)\s+(?P=word)`<br><span style="background-color: #999999;color: marktext;">hello hello</span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |

# Другое

| Паттерн                                                     | Название                                                                                                                                  | Регулярка                                                                                                                                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|-------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `(?>pattern)`                                               | Атомарная группа<br>Захватывает подстроку<br>и запрещает бэктрекинг*<br>внутри этой группы,<br>если остальная часть<br>шаблона не совпала | `(?>\d{3})\d`<br>Эта конструкция сначала пытается<br>сопоставить `\d{3}`, а затем `\d`.<br>Если первое выражение не совпадает,<br>оно не пытается вернуться назад | <span style="background-color: #999999;color: marktext;">1234</span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| `(?R)` или `(?0)`                                           | Рекурсивный шаблон<br>Вставляет текущее регулярное<br>выражение внутрь самого себя                                                        | <code>\\((?:\[^()]+\|(?R))*\\)</code><br>Это регулярное выражение<br>сопоставляет сбалансированные скобки.<br>`re.error: unknown extension ?R at position 13`     | <span style="background-color: #999999;color: marktext;">(a(b)c)</span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| <code>(?P&lt;name1>pattern1\|(?P&lt;name2>pattern2))</code> | Условные выражения<br>с именованными группами                                                                                             |                                                                                                                                                                   | <div class="code" style="border-radius:.375rem .375rem;"><div class="highlight"><pre><div class="highlight"><pre><span></span><span class="unselectable"><span class="o">&gt;&gt;&gt;</span> </span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><br><span class="unselectable"><span class="o">&gt;&gt;&gt;</span> </span>    <span class="sa">r</span><span class="s2">&quot;(?P&lt;name1&gt;pattern1\&#x7c;&quot;</span><br><span class="unselectable"><span class="o">&gt;&gt;&gt;</span> </span>    <span class="sa">r</span><span class="s2">&quot;(?P&lt;name2&gt;pattern2))&quot;</span><br><span class="unselectable"><span class="o">&gt;&gt;&gt;</span> </span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><br><span class="unselectable"><span class="o">&gt;&gt;&gt;</span> </span>    <span class="s2">&quot;pattern2&quot;</span><br><span class="unselectable"><span class="o">&gt;&gt;&gt;</span> </span><span class="p">)</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span><br><span class="unselectable"><span class="p">{</span></span><br><span class="unselectable">    <span class="s2">&quot;name1&quot;</span><span class="p">:</span> <span class="s2">&quot;pattern2&quot;</span><span class="k">,</span></span><br><span class="unselectable">    <span class="s2">&quot;name2&quot;</span><span class="p">:</span> <span class="s2">&quot;pattern2&quot;</span><span class="k">,</span></span><br><span class="unselectable"><span class="p">}</span></span><br></pre></div></pre></div></div> |

# Флаги

[https://docs.python.org/3/library/re.html#flags](https://docs.python.org/3/library/re.html#flags)

|                           |        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|---------------------------|--------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `re.A`<br>`re.ASCII`      | `(?a)` | По умолчанию `\w`, `\W`, `\b`, `\B`, `\d`, `\D`, `\s`, `\S`<br>соответствуют все юникодные символы с соответствующим качеством<br>Ускоряет работу, если все соответствия лежат внутри ASCII                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| `re.I`<br>`re.IGNORECASE` | `(?i)` | Не различать заглавные и маленькие буквы<br>Работает медленнее, но иногда удобно                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `re.M`<br>`re.MULTILINE`  | `(?m)` | Специальные символы `^` и `$` соответствуют началу и концу каждой строки                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `re.S`<br>`re.DOTALL`     | `(?s)` | По умолчанию символ `\n` конца строки не подходит под точку<br>С этим флагом точка - вообще любой символ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `re.X`<br>`re.VERBOSE`    | `(?x)` | Пробелы внутри шаблона игнорируются, за исключением случаев,<br>когда они находятся в классе символов, или когда им предшествует<br>неэкранированная обратная косая черта, или внутри токенов,<br>таких как `*?`, `(?:` или `(?P<...>`<br>Например, и не допускаются<br><div class="code" style="border-radius:.375rem .375rem;"><div class="highlight"><pre><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><br><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span><br><span class="sd">\d +  # the integral part</span><br><span class="sd">\\.    # the decimal point</span><br><span class="sd">\d *  # some fractional digits</span><br><span class="sd">&quot;&quot;&quot;</span><span class="k">,</span><br>    <span class="n">re</span><span class="o">.</span><span class="n">X</span><span class="k">,</span><br><span class="p">)</span><br><span class="n">b</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\d+.\d*&quot;</span><span class="p">)</span><br><br><span class="c1"># Wrong!</span><br><span class="n">c</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><br><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;(?s)</span><br><span class="sd">\d +  # the integral part</span><br><span class="sd">\\.    # the decimal point</span><br><span class="sd">\d *  # some fractional digits</span><br><span class="sd">&quot;&quot;&quot;</span><br><span class="p">)</span><br></pre></div></pre></div></div> |
| `re.L`<br>`re.LOCALE`     | `(?L)` | Сделать `\w`, `\W`, `\b`, `\B`<br>в соответствие без учета регистра зависимым от текущей локали<br>Этот флаг можно использовать только с шаблонами байтов                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| `re.U`<br>`re.UNICODE`    |        | В Python 3 символы Unicode сопоставляются по умолчанию для `str` шаблонов<br>Поэтому этот флаг является избыточным, **не имеет никакого эффекта**<br>и сохраняется только для обратной совместимости                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `re.DEBUG`                |        | Отображение отладочной информации о скомпилированном выражении                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `re.NOFLAG`               |        | С версии 3.11                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |

## Использование модификаторов

Можно объединять в одну группу: `(?i-sm)` (включает режим `i` и выключает режимы `s` и `m`)
Если требуется только в пределах группы, то шаблон после двоеточия
Например, `(?-i)(?i:A)bc` найдёт `abc` и `Abc`, но не `ABC`

# Примеры

|                                                                                                                              |                                                                                                     |
|------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------|
| Набор из букв и цифр (латиница)                                                                                              | `^[a-zA-Z0-9]+$`                                                                                    |
| Набор из букв и цифр (латиница + кириллица)                                                                                  | `^[а-яА-ЯёЁa-zA-Z0-9]+$`                                                                            |
| Домен (например `seo-zona.ru`)                                                                                               | `^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,6}$`                                  |
| IPv4                                                                                                                         | <code>((25\[0-5]\|2\[0-4]\d\|\[01]?\d\d?)\.){3}(25\[0-5]\|2\[0-4]\d\|\[01]?\d\d?)</code>            |
| IPv6                                                                                                                         | <code>((^\|:)(\[0-9a-fA-F]{0,4})){1,8}$</code>                                                      |
| Имя пользователя<br>(с ограничением 2-20 символов,<br>которыми могут быть буквы и цифры,<br>первый символ обязательно буква) | <code>^\[a-zA-Z]\[a-zA-Z0-9-_\.]{1,20}$</code>                                                      |
| Дата в формате `YYYY-MM-DD`                                                                                                  | <code>\[0-9]{4}-(0\[1-9]\|1\[012])-(0\[1-9]\|1\[0-9]\|2\[0-9]\|3\[01])</code>                       |
| Дата в формате `DD/MM/YYYY`                                                                                                  | <code>(0\[1-9]\|\[12]\[0-9]\|3\[01])\[- /.](0\[1-9]\|1\[012])\[- /.](19\|20)\d\d</code>             |
| Целые числа и числа с плавающей точкой<br>Разделитель точка                                                                  | `-?\d+(\.\d{0,})?`                                                                                  |
| UUID                                                                                                                         | <code>^\[0-9A-Fa-f]{8}\-\[0-9A-Fa-f]{4}\-\[0-9A-Fa-f]{4}\-\[0-9A-Fa-f]{4}\-\[0-9A-Fa-f]{12}$</code> |
| Широта или долгота                                                                                                           | `-?\d{1,3}\.\d+`                                                                                    |
| Строка в одинарных кавычках                                                                                                  | `'[^'\n]*?'`<br/>`(?<!\\)'([^'\\\n]*(?:\\.[^'\\\n]*)*)'`                                            |
| `RE_AMP` html &                                                                                                              | <code>(?i)&(?!(?:\#\[0-9]+\|\#x\[0-9a-f]+\|\[0-9a-z]+);)</code>                                     |
| 🤡                                                                                                                           | `__import__("re").compile(r"(.*.*)*^").match(str(.1+.2))`                                           |

```python
IP_RANGE = "(?:[0-1]?[0-9]?[0-9]|2[0-4][0-9]|25[0-5])"
IP_REGEXP = f"^{IP_RANGE}\.{IP_RANGE}\.{IP_RANGE}\.{IP_RANGE}$"
```

```pycon
>>> import re
>>> text = "Некоторые хорошие слова подозрительны: хор, хоровод, хороводоводовед"
>>> print(re.sub(r"\b[хХxX]\w*", lambda m: f"[censored({len(m[0])})]", text))
Некоторые [censored(7)] слова подозрительны: [censored(3)], [censored(7)], [censored(15)]
```

## Пример атомарной группы

Возьмем выражение `(?>a|ab)c` и строку `abc`:

1. Сначала регулярное выражение пытается сопоставить `a` внутри атомарной группы `(?>a|ab)`
2. После успешного совпадения с `a`, атомарная группа блокируется, и больше не возвращается назад, даже если дальнейшие совпадения не удаются
3. Затем выражение пытается сопоставить `c`, что не удается, потому что следующий символ `b`
4. В обычной группе регулярное выражение вернулось бы назад, чтобы попробовать сопоставить `ab` вместо `a`.<br>Но так как группа атомарная, бэктрекинг не происходит, и регулярное выражение не находит совпадения

```pycon
>>> import re
>>> simple_group = re.compile(r"(a|ab)c")
>>> atomic_group = re.compile(r"(?>a|ab)c")
>>> print(simple_group.search("abc").group())  # Обычная группа
abc
>>> print(atomic_group.search("abc"))  # Атомарная группа
None
>>> print(atomic_group.search("ac").group())
ac
```

# Выполнить операции в зависимости от того, была ли захвачена определенная группа

Формат условного выражения:

```regexp
(?(condition)true-regex|false-regex)
```

- `condition`: Условие, которое проверяется
Обычно это номер группы захвата (например, `1` для первой группы)
- `true-regex`: Регулярное выражение, которое применяется, если условие истинно
- `false-regex`: Регулярное выражение, которое применяется, если условие ложно (опционально)

## Примеры условных выражений

### Проверка наличия захваченной группы

```regexp
(a)?(?(1)b|c)
```

- `a` - необязательная группа
- `b` - применяется, если `a` присутствует (т.е., если группа 1 захвачена)
- `c` - применяется, если `a` отсутствует (т.е., если группа 1 не захвачена)

Совпадение: `ab` или `c`

### Условные выражения с несколькими группами

```regexp
(a)(?(1)b|c)(d)?
```

- `a` - первая группа
- Если группа 1 захвачена, проверяется `b`
- Если группа 1 не захвачена, проверяется `c`
- `d` - необязательная группа, которая захватывается, если предыдущий шаблон совпал

Совпадение: `abd` или `cd` или `ab` или `c`

# Бэктрекинг

**Бэктрекинг (backtracking)** - это процесс возврата назад по строке для поиска альтернативных путей совпадения,
если текущий путь не приводит к успешному совпадению
Регулярные выражения могут исследовать разные комбинации символов и паттернов, чтобы найти подходящее совпадение

## Пример бэктрекинга

Рассмотрим регулярное выражение `a(b|c)*d` и строку `abbbd`:

1. Начало сопоставления с `a` - успех
2. Далее идет `(b|c)*`, которое может захватить любое количество `b` или `c`
   Сначала регулярное выражение захватывает все `b`: `abbb`
3. Теперь шаблон пытается сопоставить `d` после `abbb`
   Строка заканчивается на `d`, и совпадение успешно завершается

Теперь возьмем строку `abbcd`:

1. Начало сопоставления с `a` - успех
2. Далее идет `(b|c)*`, которое снова захватывает все `b`: `abb`
3. Теперь шаблон пытается сопоставить `d` после `abb`
   Это неудача, потому что следующий символ `c`
4. Регулярное выражение возвращается (бэктрекинг) к последнему совпавшему `b`, теперь пробует совпадение с `c`: `abbc`
5. Теперь шаблон пытается сопоставить `d` после `abbc`
   Строка заканчивается на `d`, и совпадение успешно завершается

# Особенности в разных языках

## Python

### re.match
Ищет совпадение в начале строки
```python
re.match(
    pattern: str,
    string: str,
    flags: int | RegexFlag = 0,
) -> Match[str] | None:
re.compile(...).match(
    string: str,
    flags: int | RegexFlag = 0,
) -> Match[str] | None:
```

### re.search
Ищет первое совпадение в строке
```python
re.search(
    pattern: str,
    string: str,
    flags: int | RegexFlag = 0,
) -> Match[str] | None:
re.compile(...).search(
    string: str,
    flags: int | RegexFlag = 0,
) -> Match[str] | None:
```

### re.findall
Возвращает список всех непересекающихся совпадений в строке
```python
re.findall(
    pattern: str,
    string: str,
    flags: int | RegexFlag = 0,
) -> list:
re.compile(...).findall(
    string: str,
    flags: int | RegexFlag = 0,
) -> list:
```

### re.finditer
Возвращает итератор по всем совпадениям в строке
```python
re.finditer(
    pattern: str,
    string: str,
    flags: int | RegexFlag = 0,
) -> Iterator[Match[str]]:
re.compile(...).finditer(
    string: str,
    flags: int | RegexFlag = 0,
) -> Iterator[Match[str]]:
```

### re.sub
Заменяет совпадения в строке на указанный текст
```python
re.sub(
    pattern: str,
    repl: str | (Match[str]) -> str,
    string: str,
    count: int = 0,
    flags: int | RegexFlag = 0,
) -> str:
re.compile(...).sub(
    repl: str | (Match[str]) -> str,
    string: str, count: int = 0, flags: int | RegexFlag = 0,
) -> str:
```

### re.subn
То же, что и `re.sub()`, но также возвращает количество замен
```python
re.subn(
    pattern: str,
    repl: str | (Match[str]) -> str,
    string: str,
    count: int = 0,
    flags: int | RegexFlag = 0,
) -> tuple[str, int]:
re.compile(...).subn(
    repl: str | (Match[str]) -> str,
    string: str,
    count: int = 0,
    flags: int | RegexFlag = 0,
) -> tuple[str, int]:
```

### re.split
Разбивает строку по шаблону и возвращает список строк
```python
re.split(
    pattern: str,
    string: str,
    maxsplit: int = 0,
    flags: int | RegexFlag = 0,
) -> list[str]:
re.compile(...).split(
    string: str,
    maxsplit: int = 0, flags: int | RegexFlag = 0,
) -> list[str]:
```

### re.fullmatch
Проверяет, полностью ли строка соответствует шаблону
```python
re.fullmatch(
    pattern: str,
    string: str,
    flags: int | RegexFlag = 0,
) -> Match[str] | None:
re.compile(...).fullmatch(
    string: str,
    flags: int | RegexFlag = 0,
) -> Match[str] | None:
```

### re.compile
Компилирует регулярное выражение в объект регулярного выражения
```python
re.compile(
    pattern: str,
    flags: int | RegexFlag = 0,
) -> Pattern[AnyStr]:
```

## Java

### && ^
`[\w&&[^_]]` - Любой символ, подходящий под `\w`, кроме `_`

## JavaScript

### Создание регулярного выражения
Литерал (через `/.../`)
```javascript
const regex = /pattern/;
```
Конструктор (через `RegExp`)
```javascript
const regex = new RegExp("pattern");
```
> [!NOTE]
> Конструктор полезен, если паттерн динамический

### Флаги (Modifiers)

|     |                                                           |
|-----|-----------------------------------------------------------|
| `g` | Глобальный поиск (поиск всех совпадений)                  |
| `i` | Игнорировать регистр                                      |
| `m` | Многострочный режим (влияет на `^` и `$`)                 |
| `s` | Позволяет `.` соответствовать символам новой строки       |
| `u` | Поддержка юникода (для работы с многобайтовыми символами) |
| `y` | "приклеенный" режим поиска (начинается с текущей позиции) |

```javascript
const regex = /abc/i;  // Игнорирует регистр
```

### Методы регулярных выражений

#### test
Проверяет, есть ли совпадения
Возвращает `true` или `false`
```javascript
const regex = /hello/;
console.log(regex.test("Hello, world!"));  // true
```
#### exec
Возвращает массив с информацией о первом совпадении (или `null`, если не найдено)
```javascript
const regex = /hello/;
console.log(regex.exec("Hello, world!"););  // ["Hello"]
```
#### match
Метод строки, возвращает все совпадения (включая глобальные)
```javascript
console.log("ab, ac, ad".match(/a./g));  // ["ab", "ac", "ad"]
```
#### replace
Метод строки, заменяет совпадения на новый текст
```javascript
console.log("abc def abc".replace(/abc/g, "xyz"));  // "xyz def xyz"
```
#### split
Разделяет строку по шаблону регулярного выражения
```javascript
console.log("apple,banana,grape".split(/,/));  // ["apple", "banana", "grape"]
```

### Особенности и полезные моменты

#### Использование с `g` (глобальный флаг)
Для получения всех совпадений нужно использовать `g`
Без этого флага будет возвращено только первое совпадение
```javascript
const regex = /\d+/g;
console.log("abc 123 def 456 ghi".match(regex););  // ["123", "456"]
```
#### Группы (с `()`)
Используй круглые скобки для группировки и захвата частей строки
```javascript
const regex = /(\d{3})-(\d{2})-(\d{4})/;
console.log("123-45-6789".match(regex););  // ["123-45-6789", "123", "45", "6789"]
```

### Работа с многобайтовыми символами и юникодом

- Для работы с юникодом, можно использовать флаг `u` (юникодный режим),
  что позволяет работать с эмодзи и другими многобайтовыми символами
```javascript
const regex = /\u{1F600}/u;  // Эмодзи 😀
console.log(regex.test("😀"));  // true
```
- `\p{...}` - для поиска символов по категориям в Unicode
```javascript
const regex = /\p{Letter}/gu;  // Все символы, которые являются буквами
console.log(regex.test('a'));  // true
```

### Пример использования с `y` (прилипание)
В режиме "прилипание" регулярное выражение будет искать совпадение начиная с текущей позиции в строке
```javascript
const regex = /abc/y;
console.log(regex.exec("abcabc"));  // ["abc"]
console.log(regex.exec("abcabc"));  // ["abc"]
```
В режиме `y`, если в следующем вызове метода `exec()` нет совпадений с текущей позиции, вернется `null`
